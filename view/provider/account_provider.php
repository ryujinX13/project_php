<?php
session_start();
include('../../connect/connection.php');

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
if (!isset($_SESSION['provider_username'])) {
    header('Location: prov_login.php'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ login ‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
    exit;
}

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà
$prov_username = $_SESSION['provider_username']; // ‡πÉ‡∏ä‡πâ session username
$sql = "SELECT Prov_id, Prov_Username, Prov_password, Prov_name, 
        Prov_gender, Prov_birthday, Prov_addressnow, Prov_email, 
        Prov_phone, Prov_train, Prov_img FROM provider WHERE Prov_Username = ?";
$stmt = $conn->prepare($sql);

if ($stmt === false) {
    die("Prepare failed: " . $conn->error);
}

$stmt->bind_param("s", $prov_username);

if (!$stmt->execute()) {
    die("Execute failed: " . $stmt->error);
}

$result = $stmt->get_result();

if ($result === false) {
    die("Get result failed: " . $stmt->error);
}

$prov = $result->fetch_assoc();

if ($prov === null) {
    die("No provider found with the username: " . htmlspecialchars($prov_username));
}

$stmt->close();
$conn->close();

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
$prov_photo = $prov['Prov_img'] ? 'data:image/jpeg;base64,' . base64_encode($prov['Prov_img']) : '../../img/placeholder.png';
?>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</title>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../css/user/stylesaccount_user.css">
</head>

<body>
<div class="tab-bar">
    <button class="back-button" onclick="window.location.href='../user/Homepage.php'">‚¨ÖÔ∏è</button>
    <img src="../../img/logo1.png" alt="Logo" style="margin-left: 10px;">
</div>
<div class="container d-flex">
    <div class="menu-container">
        <a href="account_provider.php" class="menu-item active">
            <span style="margin-right: 8px;">üîç</span>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
        </a>
        <a href="#" class="menu-item ">
            <span style="margin-right: 8px;">üìÖ</span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        </a>
        <a href="#" class="menu-item">
            <span style="margin-right: 8px;">üìú</span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        </a>
        <a href="#" class="menu-item ">
            <span style="margin-right: 8px;">üìú</span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
        </a>
        <a href="../../process/logout.php" class="menu-item">
            <span style="margin-right: 8px;">üîì</span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </a>
    </div>
    <div class="profile-container ml-4">
        <img src="<?php echo $prov_photo; ?>" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á <?php echo htmlspecialchars($prov['Prov_name']); ?>" style="width: 100px; height: 100px;">
        <h1>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h1>
        <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</strong> <?php echo htmlspecialchars($prov['Prov_id']); ?></p>
        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> <?php echo htmlspecialchars($prov['Prov_Username']); ?></p>
        <p><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong> <?php echo htmlspecialchars($prov['Prov_name']); ?></p>
        <p><strong>‡πÄ‡∏û‡∏®:</strong> <?php echo $prov['Prov_gender'] == '0' ? '‡∏ä‡∏≤‡∏¢' : '‡∏´‡∏ç‡∏¥‡∏á'; ?></p>
        <p><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</strong> <?php echo htmlspecialchars($prov['Prov_birthday']); ?></p>
        <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> <?php echo htmlspecialchars($prov['Prov_addressnow']); ?></p>
        <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå:</strong> <?php echo htmlspecialchars($prov['Prov_email']); ?></p>
        <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> <?php echo htmlspecialchars($prov['Prov_phone']); ?></p>
        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°:</strong> <?php echo $prov['Prov_train'] == '1' ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'; ?></p>
        <a href="edit_provider.php" class="edit-button">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
